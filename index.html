<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"
        integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA=="
        crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link rel="stylesheet" href="src/styles/styles.css">

    <title>Open Tibia Spell Maker</title>
</head>

<body>
    <header>
        <div class="brand">
            <i class="fa-solid fa-wand-magic-sparkles"></i>
            OT SpellMaker
        </div>
        <div style="display: flex; gap: 15px; align-items: center;">
            <div style="display: flex; gap: 10px; align-items: center;">
                <label for="folderInput" class="action-btn" style="cursor: pointer;">
                    <i class="fa-solid fa-folder-open"></i> Load Client Folder
                </label>
                <input type="file" id="folderInput" webkitdirectory directory multiple style="display: none;"
                    onchange="loadFiles(this)">
            </div>
            <div style="font-size: 0.8rem; color: var(--text-muted); display: flex; align-items: center; gap: 8px;">
                <div style="display: flex; align-items: center; gap: 4px;">
                    <input type="checkbox" id="extendedCheck" checked onchange="updateSettings()">
                    <label for="extendedCheck">Extended</label>
                </div>
                <div style="display: flex; align-items: center; gap: 4px;">
                    <input type="checkbox" id="transparencyCheck" checked onchange="updateSettings()">
                    <label for="transparencyCheck">Transparency</label>
                </div>
            </div>
            <a href="#" style="color: var(--text-muted); text-decoration: none; font-size: 0.9rem;"
                onclick="alert('Funcionalidade em desenvolvimento')"><i class="fa-brands fa-github"></i> Repository</a>
        </div>
    </header>

    <div class="main-container">
        <!-- LEFT PANEL: PROPERTIES -->
        <aside class="panel properties-panel">
            <span class="panel-title">Spell Properties</span>

            <!-- SPELL WORK TYPE -->
            <div class="form-group">
                <label>Spell Work</label>
                <select class="form-control" id="spellWork" onchange="updateSpellWorkUI()">
                    <option value="spell-name">Spell Name</option>
                    <option value="room">Room (certify-allies)</option>
                </select>
            </div>

            <!-- REWORK TYPE -->
            <div class="form-group">
                <label>Rework</label>
                <select class="form-control" id="reworkType">
                    <option value="new-lua">new-lua</option>
                    <option value="legacy">legacy</option>
                </select>
            </div>

            <div class="form-group">
                <label>Spell Name</label>
                <input type="text" class="form-control" id="spellName" value="Mega Energy Wave">
            </div>

            <div class="form-group">
                <label>Words (Incantation)</label>
                <input type="text" class="form-control" id="spellWords" value="exevo gran vis hur">
            </div>

            <!-- EFFECT CONFIGURATION -->
            <div class="section-divider">Effect Configuration</div>

            <div class="form-group">
                <label>Effect Type</label>
                <select class="form-control" id="effectTypeSelect">
                    <option value="CONST_ME_NONE">None</option>
                    <option value="CONST_ME_DRAWBLOOD">Blood</option>
                    <option value="CONST_ME_LOSEENERGY">Lose Energy</option>
                    <option value="CONST_ME_POFF">Poff</option>
                    <option value="CONST_ME_BLOCKHIT">Block Hit</option>
                    <option value="CONST_ME_EXPLOSIONAREA">Explosion Area</option>
                    <option value="CONST_ME_EXPLOSIONHIT">Explosion Hit</option>
                    <option value="CONST_ME_FIREAREA">Fire Area</option>
                    <option value="CONST_ME_ENERGYAREA">Energy Area</option>
                    <option value="CONST_ME_ICEAREA">Ice Area</option>
                    <option value="CONST_ME_WARNING">Warning</option>
                </select>
            </div>

            <div class="form-group">
                <label>Effect Mode</label>
                <select class="form-control" id="effectMode">
                    <option value="send-magic">Send Magic</option>
                    <option value="area">Area</option>
                    <option value="distance">Distance</option>
                </select>
            </div>



            <div class="form-group">
                <label>Misfire ID (Optional)</label>
                <input type="text" class="form-control" id="misfireId" placeholder="Leave empty if none">
            </div>

            <!-- SENDMAGIC OFFSETS -->
            <div class="section-divider">SendMagic Offsets</div>

            <div class="form-row">
                <div class="form-group-half">
                    <label>SGM-X</label>
                    <input type="number" class="form-control" id="sgmX" value="0">
                </div>
                <div class="form-group-half">
                    <label>SGM-Y</label>
                    <input type="number" class="form-control" id="sgmY" value="0">
                </div>
            </div>

            <div class="form-row">
                <div class="form-group-half">
                    <label>POS-X</label>
                    <input type="number" class="form-control" id="posX" value="0">
                </div>
                <div class="form-group-half">
                    <label>POS-Y</label>
                    <input type="number" class="form-control" id="posY" value="0">
                </div>
            </div>

            <div class="form-group">
                <label>Drawn On Top</label>
                <select class="form-control" id="drawnOnTop">
                    <option value="0">Below (0)</option>
                    <option value="1">Above (1)</option>
                </select>
            </div>

            <!-- DAMAGE CONFIGURATION -->
            <div class="section-divider">Damage Configuration</div>

            <div class="form-group">
                <label>Damage Type</label>
                <select class="form-control" id="combatType">
                    <option value="COMBAT_PHYSICALDAMAGE">Physical</option>
                    <option value="COMBAT_ENERGYDAMAGE">Energy</option>
                    <option value="COMBAT_FIREDAMAGE">Fire</option>
                    <option value="COMBAT_ICEDAMAGE">Ice</option>
                    <option value="COMBAT_EARTHDAMAGE">Earth</option>
                    <option value="COMBAT_DEATHDAMAGE">Death</option>
                    <option value="COMBAT_HOLYDAMAGE">Holy</option>
                    <option value="COMBAT_HEALING">Healing</option>
                </select>
            </div>

            <div class="form-group">
                <label>Min Damage</label>
                <input type="number" class="form-control" id="minDamage" value="100">
            </div>

            <div class="form-group">
                <label>Max Damage</label>
                <input type="number" class="form-control" id="maxDamage" value="200">
            </div>

            <!-- COMBAT AREA -->
            <div class="section-divider">Combat Area</div>

            <div class="form-group">
                <label>Area Type</label>
                <select class="form-control" id="areaType">
                    <option value="single">Single Target (1x1)</option>
                    <option value="3x3">Small Area (3x3)</option>
                    <option value="5x5">Medium Area (5x5)</option>
                    <option value="7x7">Large Area (7x7)</option>
                    <option value="custom">Custom (Grid)</option>
                </select>
            </div>

            <!-- COMBAT CONFIGURATION (for current combat) -->
            <div class="section-divider">Current Combat Config</div>

            <div class="form-group">
                <label>Combat Name</label>
                <input type="text" class="form-control" id="currentCombatName" value="Combat 1"
                    onchange="updateCurrentCombat()">
            </div>

            <div class="form-group">
                <label>Combat Delay (ms)</label>
                <input type="number" class="form-control" id="currentCombatDelay" value="0"
                    onchange="updateCurrentCombat()" oninput="updateCurrentCombat()">
            </div>

            <!-- SPELL PARAMETERS -->
            <div class="section-divider">Spell Parameters</div>

            <div class="form-group">
                <label>Mana Cost</label>
                <input type="number" class="form-control" id="spellMana" value="100">
            </div>

            <div class="form-group">
                <label>Min Level</label>
                <input type="number" class="form-control" id="spellLevel" value="50">
            </div>

            <div class="form-group">
                <label>Cooldown (ms)</label>
                <input type="number" class="form-control" id="spellCooldown" value="2000">
            </div>

            <button class="btn btn-primary" onclick="generateAndNotify()">
                <i class="fa-solid fa-code"></i> Generate Script
            </button>

            <button class="btn btn-secondary" onclick="openCodeModal()" style="width: 100%; margin-top: 10px;">
                <i class="fa-solid fa-eye"></i> View Lua Code
            </button>
        </aside>

        <!-- CENTER PANEL: EDITOR -->
        <main class="panel editor-panel">
            <!-- Combat Management Tabs -->
            <div id="combatTabs" class="combat-tabs-container">
                <!-- Dynamically generated by updateCombatUI() -->
            </div>

            <div class="toolbar">
                <button class="toolbar-btn active" onclick="setGridSize(11)">11x11</button>
                <button class="toolbar-btn" onclick="setGridSize(15)">15x15</button>
                <button class="toolbar-btn" onclick="setGridSize(21)">21x21</button>
                <div style="width: 1px; background: var(--border-color); margin: 0 5px;"></div>
                <button class="toolbar-btn" onclick="clearGrid()"><i class="fa-solid fa-trash"></i> Clear</button>

                <div style="width: 1px; background: var(--border-color); margin: 0 5px;"></div>

                <!-- Background Selector -->
                <select id="bgSelector" class="toolbar-btn" onchange="setGridBackground(this.value)"
                    style="background-color: var(--input-bg); color: var(--text-main); border: 1px solid var(--border-color); padding: 6px; border-radius: 4px;">
                    <option value="grid">Grid</option>
                    <option value="light">Light Grass</option>
                    <option value="dark">Dark Grass</option>
                </select>

                <!-- Grid Zoom -->
                <div class="zoom-controls" style="display:flex; gap:8px; align-items:center;">
                    <button class="toolbar-btn" onclick="zoomGrid(-1)" title="Zoom Out"><i
                            class="fa-solid fa-minus"></i></button>
                    <span id="zoomLevel"
                        style="font-size:0.85rem; color:var(--accent-primary); font-weight:600; min-width:60px; text-align:center;">100%</span>
                    <button class="toolbar-btn" onclick="zoomGrid(1)" title="Zoom In"><i
                            class="fa-solid fa-plus"></i></button>
                    <button class="toolbar-btn" onclick="fitToScreen()" title="Fit to Screen"><i
                            class="fa-solid fa-expand"></i> Fit</button>
                </div>

                <div style="width: 1px; background: var(--border-color); margin: 0 5px;"></div>

                <button class="toolbar-btn" onclick="playAnimation()"><i class="fa-solid fa-play"></i> Test
                    Animation</button>
                <button class="toolbar-btn" onclick="stopAnimation()" style="background: rgba(255,0,0,0.2);"><i
                        class="fa-solid fa-stop"></i> Stop</button>
            </div>

            <!-- Canvas Scroll Container -->
            <div class="canvas-container">
                <div id="spell-grid">
                    <!-- Grid Cells Generate Here -->
                </div>
            </div>


        </main>

        <!-- RIGHT PANEL: ASSETS -->
        <aside class="panel assets-panel">
            <div class="assets-header">
                <div class="assets-header-top">
                    <div>
                        <h3>Browser</h3>
                    </div>
                    <div id="previewContainer" style="display: none;">
                        <img id="previewImage" src="">
                    </div>
                </div>
                <div class="tabs">
                    <div class="tab active" onclick="switchTab('magic')">Magic</div>
                    <div class="tab" onclick="switchTab('distance')">Distance</div>
                    <div class="tab" onclick="switchTab('items')">Items</div>
                </div>

                <div class="assets-search">
                    <input type="text" class="form-control" id="detailsSearch" placeholder="Search ID or Name..."
                        onkeyup="filterAssets()">
                </div>

                <div class="assets-grid" id="assetsGrid">
                    <!-- Assets Load Here -->
                </div>

                <div style="margin-top: 10px; font-size: 0.8rem; color: var(--text-muted); text-align: center;">
                    Selected ID: <span id="selectedIdDisplay"
                        style="color: var(--accent-color); font-weight: bold;">None</span>
                    <br>
                    <small>Click to select, then click on grid.</small>
                </div>
        </aside>
    </div>

    <!-- Code Modal -->
    <div id="codeModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2><i class="fa-solid fa-code"></i> Generated Lua Code</h2>
                <button class="modal-close" onclick="closeCodeModal()">
                    <i class="fa-solid fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <pre id="modalCodeOutput" class="code-display"></pre>
            </div>
            <div class="modal-footer">
                <button class="btn btn-primary" onclick="copyCode()">
                    <i class="fa-solid fa-copy"></i> Copy Code
                </button>
                <button class="btn btn-secondary" onclick="closeCodeModal()">
                    Close
                </button>
            </div>
        </div>
    </div>

    <script src="src/javascript/spr_loader.js"></script>
    <script src="src/javascript/dat_loader.js"></script>
    <script src="src/javascript/script.js"></script>
</body>

</html>